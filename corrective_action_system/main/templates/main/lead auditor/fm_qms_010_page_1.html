{% load static %}
{% block title %}{% endblock %}

{% block content %}
<style>
    #selected-descriptions {
        margin-top: 10px;
        padding: 5px;
        border: 1px solid #ccc;
        background-color: #f9f9f9;
        border-radius: 5px;
        max-width: 30%;
    }

    /* Each selected description style */
    .selected-description {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #fff;
        padding: 5px 8px;
        margin-bottom: 5px;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        font-size: 14px;
    }

    /* Delete button style */
    .delete-description {
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 5px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    }

    /* Hover effect on delete button */
    .delete-description:hover {
        background-color: #c82333;
    }
</style>

<link href="{% static 'css/internal_audit/fm-qms-010-page-1.css' %}" rel="stylesheet">

<div class="container">
    <form enctype="multipart/form-data">
        <table>
            <div class="header-container">
                <img alt="Sorsogon State University Logo" class="logo" src="{% static 'main/iso-sorsu-logo.png' %}">
                <div class="text-container">
                    <p class="republic">Republic of the Philippines</p>
                    <p class="university"><strong>SORSOGON STATE UNIVERSITY</strong></p>
                    <p class="address"><em>Magsaysay Street, Salog (Pob.), Sorsogon City, Sorsogon</em></p>
                    <p class="contact">Tel No.: 056 211-0103; Email Add.: qa.iso@sorsu.edu.ph</p>
                    <div class="separator"></div>

                </div>
                <img alt="Another Logo" class="second-logo" src="{% static 'main/bagong-pilipinas-logo.png' %}">
            </div>

            <tr>
                <td colspan="9" rowspan="3">
                    <h1 style="font-size: 75px;">REQUEST FOR ACTIONS</h1>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <label for="rfa_ref_no">RFA Ref. No. <br>
                        <input id="lead_auditor" name="auditor_type" type="checkbox" value="lead">
                        <label for="lead_auditor" style="font-size: medium;">Lead Auditor</label>
                        <input id="internal_auditor" name="auditor_type" type="checkbox" value="internal">
                        <label for="internal_auditor" style="font-size: medium;">Internal Auditor</label>
                    </label><br><br>
                    <input id="rfa_ref_no" name="rfa_ref_no" required type="text">
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <label for="date_issued">Date Issued</label> <br><br>
                    <input id="date_issued" name="date_issued" required type="date">
                </td>
            </tr>

            <tr>
                <th colspan="6">PART 1: What is wrong?</th>
                <th class="nc-data" colspan="6">NON-CONFORMITY (NC) DATA</th>
            </tr>
            <tr>
                <td colspan="3">Originator’s Name/ID No.<input name="originator_name" required type="text"></td>
                <td colspan="3">Unit/Department

                    <select id="unitDropdown" name="unit_department" required style="width: 100%;">
                        <option disabled selected value="">Select Unit/Department</option>
                        <option value="Campus Director (Ma. Elena C. Demdam)">Campus Director (Ma. Elena C. Demdam)
                        </option>
                        <option value="Records Office">Records Office</option>
                        <option value="Administrative Office">Administrative Office</option>
                        <option value="Human Resource Management Office">Human Resource Management Office</option>
                        <option value="Accounting Office">Accounting Office</option>
                        <option value="Budget Office">Budget Office</option>
                        <option value="Cashier’s Office">Cashier’s Office</option>
                        <option value="Registrars Office (Renibec Balaguer)">Registrars Office (Renibec Balaguer)
                        </option>
                        <option value="Quality Assurance Office (Mark Anthony Dipad)">Quality Assurance Office (Mark
                            Anthony Dipad)
                        </option>
                        <option value="International Relations Office (Corazon G. Bongalosa)">International Relations
                            Office (Corazon G. Bongalosa)
                        </option>
                        <option value="Gender & Development Office">Gender & Development Office</option>
                        <option value="Planning Office">Planning Office</option>
                        <option value="Library (Grace Q. Marilla)">Library (Grace Q. Marilla)</option>
                        <option value="General Services & Maintenance">General Services & Maintenance</option>
                        <option value="Supply Office">Supply Office</option>
                        <option value="Bids and Awards Committee">Bids and Awards Committee</option>
                        <option value="ILDO/Placement Office">ILDO/Placement Office</option>
                        <option value="Research and Development Office (Mary Ann D. Especial)">Research and Development
                            Office (Mary Ann D. Especial)
                        </option>
                        <option value="Extension & Training Office">Extension & Training Office</option>
                        <option value="Student Development Services Office (Rytzz M. Obsum)">Student Development
                            Services Office (Rytzz M. Obsum)
                        </option>
                        <option value="Scholarship Office (Renibec Balaguer)">Scholarship Office (Renibec Balaguer)
                        </option>
                        <option value="Medical and Health Office">Medical and Health Office</option>
                        <option value="Sports, Culture and Arts Office">Sports, Culture and Arts Office</option>
                        <option value="Guidance and Counselling Office">Guidance and Counselling Office</option>
                        <option value="Disaster Risk Reduction and Climate Change Office">Disaster Risk Reduction and
                            Climate Change Office
                        </option>
                        <option value="Dean of CICT (Rey C. Rodrigueza)">Dean of CICT (Rey C. Rodrigueza)</option>
                        <option value="Dean of BME (Diana V. Sales)">Dean of BME (Diana V. Sales)</option>
                        <option value="Program Chair of BSIT">Program Chair of BSIT</option>
                        <option value="Program Chair of BSCS">Program Chair of BSCS</option>
                        <option value="Program Chair of BSIS">Program Chair of BSIS</option>
                        <option value="Program Chair of BTVTEd">Program Chair of BTVTEd</option>
                        <option value="Program Chair of BSA/BSAIS">Program Chair of BSA/BSAIS</option>
                        <option value="Program Chair of BSEntrep">Program Chair of BSEntrep</option>
                        <option value="Program Chair of BPublicAd">Program Chair of BPublicAd</option>
                    </select>
                </td>
                <td colspan="3">Phone<input name="phone" required type="tel"></td>
                <td colspan="3">Email<input name="email" required type="email"></td>
            </tr>
            <tr>
                <td colspan="6"> This RFA is intended to:
                    <div class="checkboxes">
                        <label><input name="rfa_intent" type="checkbox" value="correct_nc"> Correct a NC / eliminate
                            source of non-conformance</label>
                        <label><input name="rfa_intent" type="checkbox" value="prevent_nc"> Prevent a potential NC /
                            mitigate risk</label>
                        <label><input name="rfa_intent" type="checkbox" value="improvement"> For Improvement</label>
                    </div>
                </td>
                <td colspan="6">Department (where NC exists) <input name="department" required type="text"></td>
            </tr>
             <tr>
                <td colspan="2">Description Of the Non-Conformance</td>
                <td colspan="10">
                    <div id="description-container">
                        <label for="description_nc">Select Descriptions:</label>
                        <!-- Allow multiple selections -->
                        <!-- New div for displaying selected descriptions with delete option, positioned below -->
                        <div id="selected-descriptions" style="text-align: left; margin-top: 10px;"></div>
                        <select name="description_nc[]" id="description_nc" multiple required style="width: 100%;">
                            <option disabled value="">Select Descriptions</option>
                            <option value="iqa_related">IQA-Related</option>
                            <option value="supplier_related">Supplier-Related</option>
                            <option value="3rd_party_audit_related">3rd Party Audit Related</option>
                            <option value="process_procedural">Process/Procedural-related</option>
                            <option value="customer_satisfaction">Customer Satisfaction Related</option>
                            <option value="kpi_quality_objective">Relates to KPI/Quality Objective Review</option>
                            <option value="hrd_related">HRD-Related</option>
                            <option value="others">Others (Please Specify)</option>
                        </select>
                        <br>
                        <label id="otherDescLabel" style="display: none;">Please specify:</label>
                        <input type="text" name="other_description" id="otherDescInput" placeholder="Specify description" style="width: 100%; display: none;">


                    </div>
                </td>
            </tr>

            <tr>
            <tr>
                <td colspan="9" rowspan="3">
                    <div class="form-group mt-4">
                        <label for="textarea-lg" style="font-size: xx-large;"><strong>Description Of the
                            Non-Conformance </strong> &nbsp; <p style="font-size: 15px; display:inline;">(Existing or
                            potential; specify the objective evidence).</p></label> <br>
                        <textarea cols="50" id="textarea-lg" name="immediate_action" rows="5"
                                  style="resize: none; width: 100%; height: 200px;"></textarea>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <label for="iso_clause_ref">ISO Clause / Reference:</label>
                    <input id="iso_clause_ref" name="iso_clause_ref" required type="text">
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <label for="category">Category</label>
                    <select id="category" name="category_type" onchange="handleCategoryChange()" required
                            style="width: 100%;">
                        <option disabled selected value="">Select Category</option>
                        <option value="major">Major</option>
                        <option value="minor">Minor</option>
                        <option value="others">Others</option>
                    </select><br>
                    <label id="otherCategoryLabel" style="display: none;">Please specify:</label>
                    <input id="otherCategoryInput" name="other_category" placeholder="Specify category"
                           style="width: 100%; display: none;"
                           type="text">
                </td>


                </td>
            </tr>

            <tr>
            <tr>
                <td colspan="9" rowspan="3">
                    <div class="form-group mt-4">
                        <label for="textarea-lg" style="font-size: xx-large;"><strong>Immediate
                            Action/Correction:</strong></label> <br>
                        <textarea cols="50" id="textarea-lg" name="immediate_action" rows="5"
                                  style="resize: none; width: 100%; height: 150px;"></textarea>

                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <label for="acknowledge_by">Acknowledged by:</label>
                    <input id="acknowledge_by" name="acknowledge_by" required type="text">
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <label for="date_acknowledge">Date</label>
                    <input id="date_acknowledge" name="date_acknowledge" required type="date">
                </td>
            </tr>
            </tr>
            <tr>
                <th colspan="6">PART 2: What is the root cause?</th>
                <th class="nc-data" colspan="6">CAUSE ANALYSIS DATA</th>
            </tr>
            <tr>
            <tr>
                <td colspan="9" rowspan="4">
                    <div class="form-group mt-4">
                        <label for="textarea-lg" style="font-size: xx-large;"><strong>CAUSE OF NON-CONFORMANCE</strong>
                            &nbsp; <p style="font-size: 15px; display:inline;">Note: Attach copy (if necessary) of root
                                cause analysis</p></label> <br>
                        <textarea cols="50" id="textarea-lg" name="immediate_action" rows="5"
                                  style="resize: none; width: 100%; height: 150px;"></textarea>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <label for="date_ca">Date</label>
                    <input id="date_ca" name="date_ca" required type="date">
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <label for="acknowledge_by">Acknowledge by:</label>
                    <input id="acknowledge_by" name="acknowledge_by" required type="text">
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <label for="date_close">Estimated Close Out Date:</label>
                    <input id="date_close" name="date_close" required type="date">
                </td>
            </tr>
            </tr>
            <tr>
                <th colspan="6">PART 3 : What solutions can we formulate?</th>
                <th class="nc-data" colspan="6">SOLUTION DATA</th>
            </tr>

            <tr>
            <tr>
                <th colspan="1" rowspan="19">
                    <div class="container_ap">
                        <h1 style="writing-mode: vertical-rl; transform: rotate(-180deg);letter-spacing: 1rem;"> ACTION
                            PLANS</h1>
                    </div>
                </th>
            </tr>
            <tr>
            <tr>
                <td colspan="8"> Note: Please use continuation sheet if necessary</td>
                <td colspan="3" style="text-align: center;"><strong>CONFIRMATION OF EFFECTS OF COUNTERMEASURES</strong>
                </td>
            </tr>
            <tr>
                <th colspan="3">
                    <label for="activities"><h2>Step-by-Step Activities</h2></label>
                </th>
                <th colspan="2">
                    <label for="responsible"><h2>Responsible Person/Unit</h2></label>
                </th>
                <th colspan="1">
                    <label for="timeframe"><h2>Time Frame</h2></label>
                </th>
                <th colspan="2">
                    <label for="resources"><h2>Resources Needed</h2></label>
                </th>
                <th colspan="3">
                    <label for="result"><h2>Result:</h2></label>
                </th>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            <tr>
                <td colspan="3"></td>
                <td colspan="2"></td>
                <td colspan="1"></td>
                <td colspan="2"></td>
                <td colspan="3"></td>
            </tr>
            </tr>
            </tr>
            <tr>
                <td colspan="5">
                    “I certify that the aforesaid action plans have been reviewed and authorized for implementation. I,
                    therefore, support the implementation of said action plans”.
                </td>
                <td colspan="2">
                    Signature:<span id="file-chosen">   No file chosen</span> <br> <br>
                    <!-- Upload Signature Section -->
                    <label class="btn btn-primary" for="signature_upload">Upload Signature</label>
                    <input id="signature_upload" name="signature" required style="display: none;" type="file"><br>

                </td>
                <td colspan="5">
                </td>
            </tr>
        </table>

        <br>
        <div class="table-container">
            <table class="doc_code" style="font-size:small;">
                <tr>
                    <td colspan="1"><label for="resources">Doc. Code:</label></td>
                    <td colspan="1"><label for="resources"><strong>FM-QMS-010</strong></label></td>
                    <td colspan="1"><label for="resources">Effectivity:</label></td>
                    <td colspan="1"><label for="resources"><strong></strong></label></td>
                </tr>
                <tr>
                    <td colspan="1"><label for="resources">Revision No.:</label></td>
                    <td colspan="1"><label for="resources"><strong></strong></label></td>
                    <td colspan="1"><label for="resources">Page No.:</label></td>
                    <td colspan="1"><label for="resources"><strong>1 of 2</strong></label></td>
                </tr>
            </table>
        </div>
    </form>
    <div class="save-button-container">
        <button class="save-button" type="submit">Save</button>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    // Display the selected file name
    const realFileBtn = document.getElementById("signature_upload");
    const fileChosen = document.getElementById("file-chosen");

    realFileBtn.addEventListener("change", function () {
        if (realFileBtn.files.length > 0) {
            fileChosen.textContent = realFileBtn.files[0].name;
        } else {
            fileChosen.textContent = "No file chosen";
        }
    });

    // Handle multiple selection for description and display below with delete option
    const descriptionDropdown = document.getElementById('description_nc');
    const selectedDescriptionsContainer = document.getElementById('selected-descriptions');

    // Store selected descriptions
    const selectedDescriptions = new Set();

    descriptionDropdown.addEventListener('change', function () {
        // Get selected options
        const selectedOptions = Array.from(descriptionDropdown.selectedOptions);

        selectedOptions.forEach(option => {
            if (!selectedDescriptions.has(option.value)) {
                // Add selected option to the set if not already added
                selectedDescriptions.add(option.value);

                // Create a div for displaying the selected description
                const descriptionDiv = document.createElement('div');
                descriptionDiv.classList.add('selected-description');
                descriptionDiv.setAttribute('data-value', option.value);

                descriptionDiv.innerHTML = `
                    ${option.textContent}
                    <button class="delete-description" data-value="${option.value}" style="margin-left: 10px;">x</button>
                `;

                selectedDescriptionsContainer.appendChild(descriptionDiv);
            }
        });

        // Show the "others" input field if "Others" is selected
        const otherDescLabel = document.getElementById('otherDescLabel');
        const otherDescInput = document.getElementById('otherDescInput');

        if (selectedOptions.some(option => option.value === 'others')) {
            otherDescLabel.style.display = 'block';
            otherDescInput.style.display = 'block';
        } else {
            otherDescLabel.style.display = 'none';
            otherDescInput.style.display = 'none';
        }
    });

    // Delete functionality for selected descriptions
    selectedDescriptionsContainer.addEventListener('click', function (event) {
        if (event.target.classList.contains('delete-description')) {
            const valueToDelete = event.target.getAttribute('data-value');

            // Remove from the selected descriptions set
            selectedDescriptions.delete(valueToDelete);

            // Remove the corresponding div from the UI
            const descriptionDiv = selectedDescriptionsContainer.querySelector(`[data-value="${valueToDelete}"]`);
            if (descriptionDiv) {
                descriptionDiv.remove();
            }

            // Unselect the option in the dropdown
            for (let i = 0; i < descriptionDropdown.options.length; i++) {
                if (descriptionDropdown.options[i].value === valueToDelete) {
                    descriptionDropdown.options[i].selected = false;
                    break;
                }
            }
        }
    });

    function handleCategoryChange() {
        const categoryDropdown = document.getElementById('category');
        const otherCategoryLabel = document.getElementById('otherCategoryLabel');
        const otherCategoryInput = document.getElementById('otherCategoryInput');

        // Show or hide the 'Other' input field and label based on selection
        if (categoryDropdown.value === 'others') {
            otherCategoryLabel.style.display = 'block';  // Show label
            otherCategoryInput.style.display = 'block';  // Show input field
        } else {
            otherCategoryLabel.style.display = 'none';  // Hide label
            otherCategoryInput.style.display = 'none';  // Hide input field
        }
    }
</script>
{% endblock %}
