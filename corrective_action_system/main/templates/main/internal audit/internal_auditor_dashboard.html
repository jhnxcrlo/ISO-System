{% extends 'main/internal audit/base.html' %}
{% block title %}Internal Audit Dashboard{% endblock %}


{% block content %}
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
     <div class="container dashboard-section">
        <div class="row g-4">
            <!-- Non-Conformities -->
            <div class="col-md-4">
            <div class="dashboard-card d-flex align-items-center">
                <i class="bi bi-kanban-fill dashboard-icon projects-icon"></i>
                <div class="dashboard-text ms-3 d-flex flex-column align-items-start">
                    <div class="d-flex align-items-center">
                        <div class="stat-number">{{ total_non_conformities_count }}</div>
                        <div class="stat-title ms-2">Non-Conformities</div>
                    </div>
                </div>
            </div>
        </div>

            <!-- Tasks -->
            <div class="col-md-4">
                <div class="dashboard-card d-flex align-items-center">
                    <i class="bi bi-file-earmark-text-fill dashboard-icon invoices-icon"></i>
                    <div class="dashboard-text ms-3 d-flex flex-column align-items-start">
                        <div class="d-flex align-items-center">
                            <div class="stat-number">23</div>
                            <div class="stat-title ms-2">Tasks</div>
                        </div>
                        <div class="stat-subtitle">Soon to be cleared</div>
                    </div>
                </div>
            </div>

            <!-- Members -->
            <div class="col-md-4">
                <div class="dashboard-card d-flex align-items-center">
                    <i class="bi bi-person-circle dashboard-icon members-icon"></i>
                    <div class="dashboard-text ms-3 d-flex flex-column align-items-start">
                        <div class="d-flex align-items-center">
                            <div class="stat-number">94</div>
                            <div class="stat-title ms-2">Members</div>
                        </div>
                        <div class="stat-subtitle">Working hard</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    <!-- Audit Section -->
    <div class="container-fluid mt-5">
        <div class="row">
            <!-- Donut Chart and Audit Summary -->
            <div class="col-md-6">
                <div class="chart-container">
                    <div class="chart-info">
                        <h4 class="report-title">
                            <i class="fas fa-clipboard-list"></i>Audit Summary
                        </h4>
                        <p>Audit Findings</p>
                        <ul>
                            <!-- Major NC -->
                            <li>
                                <span style="background-color:#8E2524; width: 15px; height: 15px; display:inline-block; margin-right:10px;"></span>
                                <span>Major NC</span> <span>{{ major_nc_count }}</span>
                            </li>
                            <!-- Minor NC -->
                            <li>
                                <span style="background-color:#F86D27; width: 15px; height: 15px; display:inline-block; margin-right:10px;"></span>
                                <span>Minor NC</span> <span>{{ minor_nc_count }}</span>
                            </li>
                            <!-- OFI (Improvement) -->
                            <li>
                                <span style="background-color:#F1D000; width: 15px; height: 15px; display:inline-block; margin-right:10px;"></span>
                                <span>OFI</span> <span>{{ ofi_count }}</span>
                            </li>
                            <!-- Good Points -->
                            <li>
                                <span style="background-color:#3BBF5D; width: 15px; height: 15px; display:inline-block; margin-right:10px;"></span>
                                <span>Good Points</span> <span>{{ good_points_count }}</span>
                            </li>
                        </ul>
                        <button class="btn btn-tertiary">See Details...</button>
                    </div>
                    <div class="chart-canvas">
                        <canvas id="myChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- ISO Audit Report Section -->
            <div class="col-md-6 ">
                <div class="report-container">
                    <h4 class="report-title"><i class="bi bi-file-earmark-check-fill"></i> ISO Audit Report</h4>
                    <p class="report-subtitle">ISO 9001:2015 Corrective Management System</p>
                    <div class="report-content">
                        <ul class="report-lines">
                            <li>
                                <span>Finding 1: Non-conformance in Quality Management</span>
                                <i class="bi bi-chevron-down"></i>
                                <div class="report-expand-content">
                                    <p>Details:</p>
                                </div>
                            </li>
                            <li>
                                <span>Finding 2: Documentation Errors</span>
                                <i class="bi bi-chevron-down"></i>
                                <div class="report-expand-content">
                                    <p>Details: </p>
                                </div>
                            </li>
                            <li>
                                <span>Finding 3: Non-compliance in Training</span>
                                <i class="bi bi-chevron-down"></i>
                                <div class="report-expand-content">
                                    <p>Details: </p>
                                </div>
                            </li>
                            <li>
                                <span>Finding 4: Inconsistent Safety Protocols</span>
                                <i class="bi bi-chevron-down"></i>
                                <div class="report-expand-content">
                                    <p>Details: </p>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js Configuration -->
    <script>
        // Get dynamic data from the Django context
    const majorNcCount = {{ major_nc_count }};
    const minorNcCount = {{ minor_nc_count }};
    const ofiCount = {{ ofi_count }};
    const goodPointsCount = {{ good_points_count }};
    
    // Setup chart data with the real values
    const ctx = document.getElementById('myChart').getContext('2d');
    const data = {
        labels: ['Major NC', 'Minor NC', 'OFI', 'Good Points'],
        datasets: [{
            data: [majorNcCount, minorNcCount, ofiCount, goodPointsCount],
            backgroundColor: [
                '#8E2524',  // Major NC (Red)
                '#F86D27',  // Minor NC (Orange - brighter)
                '#F1A839',  // Minor NC (Orange - soft)
                '#F1D000',  // OFI (Yellow)
                '#3BBF5D'   // Good Points (Green)
            ],
            hoverOffset: 4
        }]
    };

    // Create donut chart
    const myChart = new Chart(ctx, {
        type: 'doughnut',
        data: data,
        options: {
            responsive: true,
            maintainAspectRatio: false, // Disable the aspect ratio
            plugins: {
                legend: {
                    display: false // Hide default legend
                }
            },
            cutout: '70%' // Controls the inner radius of the donut
        }
    });
    </script>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js'></script>


{% endblock %}
